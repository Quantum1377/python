# ===================================================
# Braket Hub - Perfil PowerShell
# ===================================================

# Caminhos do projeto e ambiente virtual
$projectPath = "$env:USERPROFILE\Documents\BraketHub"
$venvPath = "$projectPath\braket-env"
$experimentsPath = "$projectPath\experiments"

# Criar diretório do projeto e experiments se não existirem
if (!(Test-Path $projectPath)) { New-Item -ItemType Directory -Path $projectPath }
if (!(Test-Path $experimentsPath)) { New-Item -ItemType Directory -Path $experimentsPath }

# Função para iniciar o Braket Hub
function braket-hub {
    # Entrar no diretório do projeto
    Set-Location $projectPath

    # Ativar ambiente virtual
    if (Test-Path "$venvPath\Scripts\Activate.ps1") {
        & "$venvPath\Scripts\Activate.ps1"
    } else {
        Write-Host "Ambiente virtual não encontrado em $venvPath"
        Write-Host "Crie o ambiente antes de continuar: python -m venv braket-env"
        return
    }

    # Função global para rodar experimentos
    function global:braket {
        param([string]$experiment)

        if (-not $experiment) {
            Write-Host "Use: braket <nome-do-experimento> ou braket list"
            return
        }

        # Listar experimentos
        if ($experiment -eq "list") {
            $files = Get-ChildItem "$experimentsPath" -Filter "*.py"
            if ($files.Count -eq 0) {
                Write-Host "Não há experimentos disponíveis."
                Write-Host "Crie um novo com: braket new <nome>"
            } else {
                Write-Host "Experimentos disponíveis:"
                foreach ($file in $files) {
                    Write-Host " - $($file.BaseName)"
                }
            }
            return
        }

        # Criar novo experimento
        if ($experiment -eq "new") {
            Write-Host "Use: braket new <nome-do-experimento>"
            return
        }

        if ($args[0] -eq "new") {
            if ($args.Count -lt 2) { Write-Host "Use: braket new <nome>"; return }
            $newName = $args[1]
            $newPath = Join-Path $experimentsPath "$newName.py"
            if (Test-Path $newPath) { Write-Host "Experimento já existe"; return }
            Set-Content -Path $newPath -Value "from braket.circuits import Circuit`ninput('Experimento $newName - pressione Enter para rodar')"
            Write-Host "Experimento $newName criado em $experimentsPath"
            return
        }

        # Rodar experimento existente
        $scriptPath = Join-Path $experimentsPath "$experiment.py"
        if (Test-Path $scriptPath) {
            Write-Host "Rodando experimento: $experiment"
            python $scriptPath
        } else {
            Write-Host "Experimento '$experiment' não encontrado."
            braket list
        }
    }

    # Função global para editar experimentos
    function global:edit-braket {
        param([string]$experiment)
        if (-not $experiment) {
            Write-Host "Use: edit-braket <nome-do-experimento>"
            return
        }
        $filePath = Join-Path $experimentsPath "$experiment.py"
        if (!(Test-Path $filePath)) {
            Write-Host "Experimento '$experiment' não existe."
            return
        }
        notepad $filePath
    }

    Write-Host "Braket Hub carregado!"
    Write-Host "Use: braket <nome-do-experimento>"
    Write-Host "Para listar: braket list"
    Write-Host "Para criar: braket new <nome>"
    Write-Host "Para editar: edit-braket <nome>"
}
# ===================================================
# Fim do Braket Hub
# ===================================================
